# 工具模块

## 概述

ET框架提供丰富的开发工具，包括配置导出、代码生成、Proto转换、资源打包等工具，大大提升了开发效率。

## 工具目录

```
Tools/
├── Config/              # 配置工具
├── Luban/               # 配置生成工具
└── RecastNavExportor/   # 导航导出工具

Share/Tool/
├── ExcelExporter/       # Excel导出工具
└── Proto2CS/            # Proto转换工具
```

## Excel导出工具

### 功能
- 导出Excel配置为Luban格式
- 生成配置代码
- 支持多种数据类型

### 使用方法

```powershell
# 导出配置
pwsh -Command "dotnet Bin/ET.ExcelExporter.dll"
```

### Excel配置结构

```
Config/Excel/
├── Datas/
│   ├── AIConfig.xlsx        # AI配置
│   ├── BuffConfig.xlsx      # Buff配置
│   └── __beans__.xlsx       # 配置定义
└── Defines/
    └── __root__.xml         # 根配置
```

### 配置定义

```xml
<!-- __root__.xml -->
<?xml version="1.0" encoding="utf-8"?>
<root>
    <bean name="AIConfig">
        <var name="Id" type="int"/>
        <var name="Name" type="string"/>
        <var name="BehaviorTree" type="string"/>
        <var name="AttackRange" type="float"/>
    </bean>
</root>
```

### 配置数据

```
AIConfig.xlsx:
Id  Name           BehaviorTree    AttackRange
1   GuardAI        GuardTree       5.0
2   ChaseAI        ChaseTree       10.0
3   AttackAI       AttackTree      3.0
```

### 导出结果

```csharp
// 生成的配置代码
public partial class AIConfigCategory : ConfigSingleton<AIConfigCategory>, IMerge
{
    private Dictionary<int, AIConfig> dict = new();
    
    public AIConfig Get(int id)
    {
        return this.dict[id];
    }
    
    public Dictionary<int, AIConfig> GetAll()
    {
        return this.dict;
    }
}

public partial class AIConfig : IConfig
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string BehaviorTree { get; set; }
    public float AttackRange { get; set; }
}
```

## Proto转换工具

### 功能
- 将Proto文件转换为C#代码
- 生成消息序列化代码
- 支持RPC调用

### 使用方法

```powershell
# 导出Proto
pwsh -Command "dotnet Bin/ET.Proto2CS.dll"
```

### Proto定义

```protobuf
// Proto文件
syntax = "proto3";

package ET;

// 请求消息
message C2M_TestRobotCase1
{
    int32 RpcId = 1;
    string Name = 2;
    int32 Value = 3;
}

// 响应消息
message M2C_TestRobotCase1
{
    int32 RpcId = 1;
    int32 Error = 2;
    string Message = 3;
}
```

### 生成的C#代码

```csharp
// 生成的消息代码
[Message]
public partial class C2M_TestRobotCase1 : MessageObject, IActorLocationRequest
{
    public int RpcId { get; set; }
    public string Name { get; set; }
    public int Value { get; set; }
}

[Response]
public partial class M2C_TestRobotCase1 : MessageObject, IActorLocationResponse
{
    public int RpcId { get; set; }
    public int Error { get; set; }
    public string Message { get; set; }
}
```

## Luban配置工具

### 功能
- 强大的配置管理系统
- 支持多种配置格式
- 类型安全的配置访问

### 安装

```bash
# 克隆Luban仓库
git clone https://github.com/focus-creative-games/luban.git

# 编译Luban
cd luban
dotnet build
```

### 配置文件

```xml
<!-- luban.conf -->
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <datasource>
        <excel dir="Config/Excel/Datas"/>
    </datasource>
    
    <output>
        <code dir="Unity/Assets/Scripts/Model/Generate/Client"/>
        <data dir="Config/Excel/c"/>
    </output>
    
    <target>
        <name>client</name>
        <assembly>Unity.Model</assembly>
    </target>
</configuration>
```

### 生成命令

```bash
# 生成客户端配置
./gen_code_client.sh

# 生成服务端配置
./gen_code_server.sh

# 生成客户端和服务端配置
./gen_code_client_server.sh
```

## Recast导航导出工具

### 功能
- 导出Unity导航网格
- 生成Recast格式数据
- 支持多平台

### 使用方法

```
1. 打开RecastNavExportor工具
2. 选择要导出的场景
3. 配置导出参数
4. 点击导出按钮
```

### 导出参数

```
- Cell Size: 单元格大小
- Cell Height: 单元格高度
- Agent Height: 角色高度
- Agent Radius: 角色半径
- Max Slope: 最大坡度
- Max Climb: 最大攀爬高度
```

### 导出结果

```
Config/Recast/
├── Map1/           # 地图1导航数据
├── Map2/           # 地图2导航数据
└── Map3/           # 地图3导航数据
```

## 代码生成工具

### ETSystemGenerator

```csharp
// 自动生成System代码
[EntitySystemOf(typeof(PlayerComponent))]
public static partial class PlayerComponentSystem
{
    // 自动生成Awake方法
    [EntitySystem]
    private static void Awake(this PlayerComponent self)
    {
        // 初始化逻辑
    }
}
```

### GetComponentGenerator

```csharp
// 自动生成GetComponent方法
PlayerComponent player = entity.GetComponent<PlayerComponent>();
```

### EntitySerializeFormatterGenerator

```csharp
// 自动生成序列化代码
public void Serialize(MemoryBuffer buffer)
{
    buffer.Write(this.Id);
    buffer.Write(this.Name);
}
```

## 构建工具

### 编译脚本

```powershell
# 编译整个解决方案
pwsh -Command "dotnet build ET.sln"

# 编译特定项目
pwsh -Command "dotnet build Unity.Model/Unity.Model.csproj"
```

### 发布脚本

```powershell
# 发布Windows版本
pwsh -File Publish-win-x64.ps1

# 发布Linux版本
pwsh -File Publish-linux-x64.ps1
```

## 资源打包工具

### YooAsset打包

```
1. 打开Unity
2. 进入YooAsset -> AssetBundle Builder
3. 配置构建参数
4. 点击Build按钮
```

### 构建参数

```
- Build Output: 构建输出目录
- Build Mode: 构建模式
- Compression: 压缩方式
- Encryption: 是否加密
```

## 调试工具

### 日志系统

```csharp
// 普通日志
Log.Debug("Debug message");

// 错误日志
Log.Error("Error message");

// 控制台日志
Log.Console("Console message");
```

### 性能分析

```
1. 打开Unity Profiler
2. 选择CPU Usage
3. 分析性能瓶颈
4. 优化代码
```

### 内存分析

```
1. 打开Unity Memory Profiler
2. 捕获内存快照
3. 分析内存使用
4. 查找内存泄漏
```

## 最佳实践

### 1. 工具使用
- 熟练使用各种工具
- 定期更新工具版本
- 学习工具高级功能

### 2. 配置管理
- 使用版本控制
- 配置文档化
- 配置验证

### 3. 代码生成
- 使用代码生成工具
- 保持生成的代码最新
- 不要手动修改生成的代码

### 4. 自动化
- 编写自动化脚本
- 集成到CI/CD
- 定期测试

## 常见问题

### Q: Excel导出失败怎么办?
A: 
1. 检查Excel格式
2. 查看错误日志
3. 确认配置定义
4. 重新导出

### Q: Proto生成代码不正确?
A: 
1. 检查Proto语法
2. 确认包名和命名空间
3. 重新生成代码
4. 检查生成参数

### Q: 如何添加自定义工具?
A: 
1. 在Share/Tool目录创建工具
2. 实现工具逻辑
3. 添加到构建脚本
4. 编写使用文档

## 相关文档

- [ECS架构](ECS架构.md)
- [Fiber模块](Fiber模块.md)
- [热更新机制](热更新机制.md)
- [项目概述](项目概述.md)
